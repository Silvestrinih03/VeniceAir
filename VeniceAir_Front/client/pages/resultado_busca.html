<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeniceAir Buscas</title>
    <link href="../../Geral/assets/css/header_page.css" rel="stylesheet"/>
    <link href="../../admin/assets/css/listagem.css" rel="stylesheet"/>
    <script>
                let ori = sessionStorage.getItem("ORIGEM");    
                console.log("ori: ",ori)

                let dest = sessionStorage.getItem("DESTINO");    
                console.log("dest: ", dest)

                let dt = sessionStorage.getItem("DATAIDA");    
                console.log("dt: ", dt)

        document.addEventListener('DOMContentLoaded', function () {
           listarVoos();
       });

       function MessageStatus(msg, error){
                   var pStatus = document.getElementById("status");
   
                   if(error === true){
                       pStatus.className = " statusError";
                   }
                   else{
                       pStatus.className = 'statusSuccess'
                   }
                   pStatus.textContent = msg;
               }

        function messageStatusBUSCA(msg, error) {
          const pStatusBUSCA = document.getElementById('statusBUSCA');
          pStatusBUSCA.className = error ? 'statusErrorBUSCA' : 'statusSuccessBUSCA';
          pStatusBUSCA.textContent = msg;
      }

      function fetchBuscarVoo({ ori: origem, dest: destino, dt: data }) {
            const requestOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ori, dest, dt })
            };
            return fetch('http://localhost:3000/buscarVoo', requestOptions).then(T => T.json());
        }
                
               function fetchListar() {
                   const requestOptions = {
                       method: 'POST',
                       headers: {'Content-Type': 'application/json'},
                   };

                   return fetch('http://localhost:3000/buscarVoo', requestOptions).then(T => T.json());
               }


               function listarVoos(){
                    const dataBody = document.getElementById('dataBody');
                    const ori = sessionStorage.getItem("ORIGEM");
                    const dest = sessionStorage.getItem("DESTINO");
                    const dt = sessionStorage.getItem("DATAIDA");
                    console.log('origggem =', ori);
                    console.log('destttino =', dest);
                    console.log('daaata =', dt);
                    //fetchBuscarVoo(ori, dest, dt)
                    fetchBuscarVoo({ori, dest, dt})
                        .then(customResponse2 => {
                            if (customResponse2.status === 'SUCCESS') {

                                // Limpa qualquer conteúdo anterior da tabela
                                dataBody.innerHTML = '';
                                
                                // Preenche a tabela com os dados da resposta
                                // Editar???
                                customResponse2.payload.forEach(item => {
                                    const idvoo = item[0];
                                    const trecho_origem = item[1];
                                    const trecho_destino = item[2];
                                    const data = item[3];
                                    const hora_partida = item[4];
                                    const hora_chegada = item[5];
                                    const aeroporto_partida = item[6];
                                    const aeroporto_chegada = item[7];
                                    const valor = item[8];

                                    const row = dataBody.insertRow();
                                    const cell1 = row.insertCell(0);
                                    const cell2 = row.insertCell(1);
                                    const cell3 = row.insertCell(2);
                                    const cell4 = row.insertCell(3);
                                    const cell5 = row.insertCell(4);
                                    const cell6 = row.insertCell(5);
                                    const cell7 = row.insertCell(6);
                                    const cell8 = row.insertCell(7);
                                    const cell9 = row.insertCell(8);
                                    cell1.textContent = idvoo;
                                    cell2.textContent = trecho_origem;
                                    cell3.textContent = trecho_destino;
                                    cell4.textContent = data;
                                    cell5.textContent = hora_partida;
                                    cell6.textContent = hora_chegada;
                                    cell7.textContent = aeroporto_partida;
                                    cell8.textContent = aeroporto_chegada;
                                    cell9.textContent = valor;

                                });

                                messageStatusBUSCA('Voos encontrados!', false);
                            } else {
                                messageStatusBUSCA('Erro ao buscar voos: ' + customResponse2.message, true);
                                console.log(customResponse2.message);
                            }
                        })
                        .catch((e) => {
                            messageStatusBUSCA('Erro técnico ao buscar voos. Contate o suporte.', true);
                            console.log('Falha grave ao buscar voos.' + e);
                        });
                    }

                //    fetchListar()
                //        .then(customResponse => {
                //        if(customResponse.status === "SUCCESS"){
                           
                //            // Limpa qualquer conteúdo anterior da tabela
                //            dataBody.innerHTML = '';
   
                //            // Preenche a tabela com os dados da resposta
                //            // Editar???
                //            customResponse.payload.forEach(item => {
                //                const idvoo = item[0];
                //                const trecho_origem = item[1];
                //                const trecho_destino = item[2];
                //                const data = item[3];
                //                const hora_partida = item[4];
                //                const hora_chegada = item[5];
                //                const aeroporto_partida = item[6];
                //                const aeroporto_chegada = item[7];
                //                const valor = item[8];
   
                //                const row = dataBody.insertRow();
                //                const cell1 = row.insertCell(0);
                //                const cell2 = row.insertCell(1);
                //                const cell3 = row.insertCell(2);
                //                const cell4 = row.insertCell(3);
                //                const cell5 = row.insertCell(4);
                //                const cell6 = row.insertCell(5);
                //                const cell7 = row.insertCell(6);
                //                const cell8 = row.insertCell(7);
                //                const cell9 = row.insertCell(8);
                //                cell1.textContent = idvoo;
                //                cell2.textContent = trecho_origem;
                //                cell3.textContent = trecho_destino;
                //                cell4.textContent = data;
                //                cell5.textContent = hora_partida;
                //                cell6.textContent = hora_chegada;
                //                cell7.textContent = aeroporto_partida;
                //                cell8.textContent = aeroporto_chegada;
                //                cell9.textContent = valor;
                //            });
                //        }else{
                //            MessageStatus("Erro ao listar voos...: " + customResponse.message, true);
                //            console.log(customResponse.message);
                //        }
                //        })
                //        .catch((e)=>{
                //            MessageStatus("Erro técnico ao listar... Contate o suporte.", true);
                //            console.log("Falha grave ao listar." + e)
                //        });
               
                
           

   </script>
</head>
<body>
    <div id="header_page">
        <div id="img_logo">
            <img src="../../Geral/assets/images/logo.png"> 
        </div>
        <div id="title_page">
            <h1>VeniceAir <br> Resultado da busca</h1>
        </div>
        <div id="button_padrao">
            <button id="padrao_button"><a href="area_cliente.html">Voltar</a></button>
        </div>
    </div>
    <table id="dataTable">
        <thead>
            <tr>
                <th>ID</th>
                <!-- <th>IDENTIFICAÇÃO DO VOO</th -->
                <th>TRECHO</th>
                <th>DATA</th>
                <th>HORA PARTIDA</th>
                <th>HORA CHEGADA</th>
                <th>TOTAL DE HORAS</th>
                <th>AEROPORTO DE PARTIDA</th>
                <th>AEROPORTO DE CHEGADA</th>
                <th>VALOR</th>
            </tr>
        </thead>
        <tbody id="dataBody"></tbody>
    </table>
    <p id="statusBUSCA" class="statusErrorBUSCA"></p>
    <p>Este botão serve para ir até a página de pagamento, no entanto ele será removido no futuro</p>
    <button><a href="pagina_pagamento.html">Página de pagamento</a></button>
</body>
</html>