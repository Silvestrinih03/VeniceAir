<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard VeniceAir</title>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
            carregarCidades('campo_select2');
            carregarCidades('campo_select3');
      // GAMBIARRA COM CSS
        });

        function carregarCidades(idSelect) {
            fetch('http://localhost:3000/listarCidades')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById(idSelect);
                    data.payload.forEach(cidade => {
                        const option = document.createElement('option');
                        option.value = cidade[0];
                        option.text = cidade[1];
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar cidades:', error);
                });
        }

        function preencheuTipoPassagem() {
            const tipoSelecionado = document.getElementById('campo_select').value;
            return tipoSelecionado !== '0';
        }

        function preencheuPartida() {
            const partidaSelecionada = document.getElementById('campo_select2').value;
            return partidaSelecionada !== '0';
        }

        function preencheuChegada() {
            const chegadaSelecionada = document.getElementById('campo_select3').value;
            return chegadaSelecionada !== '0';
        }

        function preencheuDataIda(){
                let resultado = false;

                const dataIda = document.getElementById('data_ida').value;
                if(data.length > 0){
                    resultado = true;
                }
                return resultado;
            }

            function preencheuDataVolta(){
                let resultado = false;

                const dataIda = document.getElementById('data_volta').value;
                if(data.length > 0){
                    resultado = true;
                }
                return resultado;
            }


        function messageStatus(msg, error) {
            const pStatus = document.getElementById('status');
            if (error) {
                pStatus.className = 'statusError';
            } else {
                pStatus.className = 'statusSuccess';
            }
            pStatus.textContent = msg;
        }

        // BACK
        function fetchBuscarVoo(AAAAAAAAAAAAAAAAAA) {
            const requestOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ AAAAAAAAAAAAAAAAAAAAA})
            };

            return fetch('http://localhost:3000/buscarVoo', requestOptions).then(T => T.json());
        }

        // E SE O USUARIO ESCOLHER A MESMA CIDADE NA PARTIDA E NA CHEGADA?????????? VERIFICAR!!!!!!!!
        function BuscarVoo() {
            if (!preencheuPartida()) {
                messageStatus('Selecione a cidade de partida!', true);
                return;
            }
            if (!preencheuChegada()) {
                messageStatus('Selecione a cidade de chegada!', true);
                return;
            }
            if (!preencheuTipoPassagem()) {
                messageStatus('Selecione o tipo de passagem!', true);
                return;
            }
            if (!preencheuDataIda()) {
                messageStatus('Selecione a data de ida!', true);
                return;
            }
            
            const tipoPassagem = document.getElementById('campo_select').value;
            // pra verificar se foi selecionada a data de retorno, verifica de o tipo de passagem é ida e volta (opcao 2)
            if (tipoPassagem === '2') {
                // se for igual a 2 entao ele chama a funcao de verificar se o usuario preencheu a data de retorno
                if (!preencheuDataVolta()) {
                    messageStatus('Selecione a data de volta!', true);
                    return;
                }
            }

            // BACK!!!!!!!!!!!!!!!!
            const origem = document.getElementById('comboOrigem').value;
            const destino = document.getElementById('comboDestino').value;

            fetchInserirTrecho(origem, destino)
                .then(customResponse => {
                    if (customResponse.status === 'SUCCESS') {
                        messageStatus('Trecho cadastrado...', false);
                    } else {
                        messageStatus('Erro ao cadastrar trecho: ' + customResponse.message, true);
                        console.log(customResponse.message);
                    }
                })
                .catch((e) => {
                    messageStatus('Erro técnico ao cadastrar trecho. Contate o suporte.', true);
                    console.log('Falha grave ao cadastrar trecho.' + e);
                });
        }
    </script>


    <link href="../../Geral/assets/css/header_page.css" rel="stylesheet"/>
    <link href="../assets/area_cliente.css" rel="stylesheet"/>
</head>
<body>
    <div id="header_page">
        <div id="img_logo">
            <img src="../../Geral/assets/images/logo.png"> 
        </div>
        <div id="title_page">
            <h1>VeniceAir</h1>
        </div>
        <div id="button_padrao">
            <button id="padrao_button"><a href="../../Geral/dashboard.html">Home</a></button>
        </div>
    </div>
    <div id="slogan">
      <p>THE BRIGHTNESS ON THE SKY</p>
    </div>
    <div id="busca_div">
      <p>BUSCA DE VOOS</p>
      <form id="busca_form">
        <div id="div_campos" class="mb-3">
          <select id="campo_select" class="form-select" aria-label="Default select example">
            <option selected>Tipo de passagem</option>
            <option value="1">Ida</option>
            <option value="2">Ida e volta</option>
          </select>
          <!-- <input id="campo_cidade" type="text" class="input_cidade" id="partida" placeholder="Partida de "> -->
          <select id="campo_select2" class="campo_cidade" aria-label="Default select example">
            <option value="0">Partida de </option>
          </select>
          <!-- <input id="campo_cidade" type="text" class="input_cidade" id="partida" placeholder="Chegada a"> -->
          <select id="campo_select3" class="campo_cidade" aria-label="Default select example">
            <option value="0">Chegada a </option>
          </select>
        </div>
        <div id="div_campos" class="div_data">
          <label id="label_calendario" for="data_ida" class="data_ida">Data de Ida</label>
          <label id="label_calendario" for="data_volta" class="data_volta">Data retorno</label>
        </div>
        <div id="div_campos" class="div_data">
          <input id="campo_data" type="date" class="form-control" id="exampleInputPassword1" placeholder="Data">
          <input id="campo_data" type="date" class="form-control" id="exampleInputPassword1" placeholder="Data">
        </div>
        <div id="div_botao" class="mb-3">
          <button id="buscar"><a href="resultado_busca.html">Buscar</a></button>
          <button type="reset" id="buscar">Limpar</button>
        </div>
      </form>
    </div>
    <div id="informacoes">
      <div id="central-ajuda">
        <h3>Precisa de ajuda com a sua reserva?</h3>
        <p>Central de atendimento VeniceAir: <strong>+55 19 98756-2511</strong></p>
        <p><strong>Idiomas falados:</strong> Português - Francês - Inglês</p>
        <p><strong>Horário de funcionamento:</strong> 08:00 até 20:00</p>
      </div>
      <div id="feedback">
        <h3>Avaliação e sugestões sobre a VeniceAir: </h3>
        <label id="feedback_label">Nome</label>
        <input type="text" placeholder="Insira seu nome aqui" id="campos_feedback">
        <label id="feedback_label">E-mail</label>
        <input type="email" placeholder="Insira seu endereço de e-mail" id="campos_feedback">
        <label id="feedback_label">Deixe sua avalidação</label>
        <select id="campos_feedback">
          <option value="0">Nota</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <label id="feedback_label">Conte sobre sua experiência com a VeniceAir e/ou suas sugestões de melhoria</label>
        <input type="text" id="campos_feedback" placeholder="Descrição">
      </div>
    </div>
</body>
</html>
